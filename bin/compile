#!/usr/bin/env ruby
# frozen_string_literal: true

require 'optparse'
require 'bundler/setup'
require 'ruby_md_ssg'

RubyMdSsg::Paths.reset!
RubyMdSsg::Paths.root = Dir.pwd

options = {
  docs: RubyMdSsg::Paths.docs_dir,
  build: RubyMdSsg::Paths.build_dir,
  assets: RubyMdSsg::Paths.assets_dir,
  menu: RubyMdSsg::Paths.menu_config,
  base_url: ENV['RUBY_MD_SSG_BASE_URL']
}

OptionParser.new do |parser|
  parser.banner = 'Usage: bin/compile [options]'
  parser.on('--docs PATH', 'Directory containing markdown docs') { |path| options[:docs] = File.expand_path(path) }
  parser.on('--build PATH', 'Build output directory') { |path| options[:build] = File.expand_path(path) }
  parser.on('--assets PATH', 'Assets directory') { |path| options[:assets] = File.expand_path(path) }
  parser.on('--menu PATH', 'Menu configuration path') { |path| options[:menu] = File.expand_path(path) }
  parser.on('--base-url URL', 'Base URL for sitemap entries') { |url| options[:base_url] = url }
end.parse!

compiler = RubyMdSsg::Compiler.new(
  docs_dir: options[:docs],
  build_dir: options[:build],
  assets_dir: options[:assets],
  menu_path: options[:menu],
  base_url: options[:base_url]
)

compiler.compile

puts "Site compiled to #{options[:build]}"
